---
layout: 01_post
title: "Improving Text Rendering"
author: Hermann Kraus
category: Mapnik
---

<p>My Summer of Code project this year is about improving Mapnik's text rendering. There are two problems with the way text is currently rendered. I'll describe these problems and show how I intend to solve them.</p><h2>Dynamic placement</h2><p>When rendering crowded areas there is often no space to place a label at the point it should go to and the label therefore is dropped. </p><iframe width="100%" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.openstreetmap.org/export/embed.html?bbox=12.09175,49.01859,12.09446,49.01987&amp;layer=mapnik" style="border: 1px solid black"></iframe><br /><small><a href="http://www.openstreetmap.org/?lat=49.01923&amp;lon=12.093105&amp;zoom=18&amp;layers=M">View Larger Map</a></small><p>In the example above many symbols are missing a label because there was no space, but they could have been shown when moved a bit. I already worked on this problem this winter and now you can tell Mapnik 2 to <a href="http://trac.mapnik.org/wiki/TextSymbolizer#Placements">try different locations and font sizes</a>. But the algorithm is quite limited at the moment and many important properties can't be changed. So the first part of my work is to add these missing features. The most important change will be that one is able to change the text. So if rendering "Example Street" fails, it could try "Example St.".</p><h2>Improved formatting</h2><p>The other big problem is that Mapnik doesn't have any means to change formatting in a TextSymbolizer. When you try to label a mountain peak with name and elevation like this </p><div style="width:30%"><center><b>Name</b><br /><i>Elevation</i></center></div><p>you need two symbolizers, one for the name and one for the elevation and calculate a appropriate offset for the second one. But if the name is a bit longer and mapnik splits it into multiple lines this calculation is wrong, the texts overlap and mapnik drops one. </p><p>My project is to add formating capabilities to TextSymbolizers. When I'm done one will only need one symbolizer for this job and the positions will adjust automatically.</p> 

