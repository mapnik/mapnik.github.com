---
layout: 01_post
title: "New text placement system"
author: Herman Kraus
category: Mapnik
---

<p>The first part of my Google Summer of Code project is completed now. </p><p>As a result one can choose arbitrary alternative placements for TextSymbolizers if the default placement fails. However this is no longer limited to placements, but one can also change text, font size, color, etc. Everything is fully configurable now.</p><p>When two labels are too close to each other normally one label is placed and the other one is simply ignored. This can lead to undesirable results. Look at the following sample image:</p><img src="/images/old-placement.png" alt="Previously"><p>With the new placement system one can tell Mapnik to try different placement options. In this example I defined the following parameters:</p><ul><li>First try to place the label below the number with font size 16 (color: blue)</li><li>Then try to place it above with font size 10 (color: red)</li><li>Last try to use a shortened label text (color: green)</li></ul><img src="/images/new-placement.png" alt="Now"><p>The syntax to configure this is pretty easy:</p><pre>&lt;TextSymbolizer name="'Long'+[nr]"  face-name="DejaVu Sans Book" size="16"  placement="point" dy="8" fill="blue" /&gt;</pre><p>becomes</p><pre>&lt;TextSymbolizer name="'Long'+[nr]"   face-name="DejaVu Sans Book" size="16"   placement="point" dy="8" fill="blue"   <b>placement-type="list"</b>&gt;    &lt;Placement size="10" dy="-8" fill="red"/&gt;    &lt;Placement name="'S'+[nr]" fill="green"/&gt;&lt;/TextSymbolizer&gt;</pre><p>One can add as many placement options as one wants. Each attribute has the same name as in TextSymbolizer (in fact they share the parser). Each placement inherits all attributes from the previous one. Therefore it is not required to add 'size="10"' in the second Placement tag.</p><p>The code is not already included in trunk, but is available in the branch <b>svn.mapnik.org/branches/textplacement</b>.</p><p>In the second half of summer of code I will add text formating capabilities to mapnik as described in <a href="http://mapnik.org/news/2011/may/28/improving_text_rendering/">an older post</a>.</p>

